-- Ducky Auto Defense v3.0 - ULTRA PREMIUM EDITION
-- Automatic base protection with ESP detection & admin integration
-- Created by Ducky Team - discord.gg/duGj8hjB

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

print("üõ°Ô∏è Ducky Auto Defense v3.0 loading...")

-- Premium Color Palette
local COLORS = {
	PRIMARY = Color3.fromRGB(99, 102, 241),
	PRIMARY_LIGHT = Color3.fromRGB(129, 140, 248),
	PRIMARY_DARK = Color3.fromRGB(79, 70, 229),
	PRIMARY_GLOW = Color3.fromRGB(139, 150, 255),
	
	ACCENT = Color3.fromRGB(236, 72, 153),
	ACCENT_LIGHT = Color3.fromRGB(251, 113, 133),
	ACCENT_DARK = Color3.fromRGB(219, 39, 119),
	
	SUCCESS = Color3.fromRGB(34, 197, 94),
	SUCCESS_GLOW = Color3.fromRGB(74, 222, 128),
	WARNING = Color3.fromRGB(251, 146, 60),
	DANGER = Color3.fromRGB(239, 68, 68),
	
	BG_GLASS = Color3.fromRGB(15, 23, 42),
	BG_GLASS_LIGHT = Color3.fromRGB(30, 41, 59),
	BG_DARK = Color3.fromRGB(2, 6, 23),
	BG_CARD = Color3.fromRGB(20, 28, 48),
	
	TEXT = Color3.fromRGB(248, 250, 252),
	TEXT_MUTED = Color3.fromRGB(148, 163, 184),
	TEXT_DARK = Color3.fromRGB(100, 116, 139),
}

-- Animation presets
local ANIM = {
	INSTANT = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
	FAST = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
	SMOOTH = TweenInfo.new(0.4, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
	BOUNCE = TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
	ELASTIC = TweenInfo.new(0.7, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out),
}

-- Defense Settings
local Settings = {
	-- Main toggles
	DefenseEnabled = false,
	AutoAdminPanel = false,
	NotifyOnIntruder = false,
	ShowESP = true,
	
	-- Detection settings
	DefenseRange = 50,
	DetectionDelay = 0.5,
	CooldownTime = 15,
	
	-- Admin commands
	UseAdminCommands = false,
	AdminCommands = {"balloon", "ragdoll", "jail", "jumpscare", "inverse"},
	CommandDelay = 0.2,
	
	-- ESP settings
	ESPColor = COLORS.DANGER,
	ESPThickness = 2,
	ShowDistance = true,
	ShowName = true,
}

local detectionConnections = {}
local intruderCooldowns = {}
local playerCards = {}
local playerESP = {}
local baseCenter = nil
local baseBounds = nil
local currentTab = "Defense"

-- Create UI
local gui = Instance.new("ScreenGui")
gui.Name = "DuckyAutoDefense"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.DisplayOrder = 9998

local success, playerGui = pcall(function()
	return player:WaitForChild("PlayerGui", 5)
end)

if success and playerGui then
	gui.Parent = playerGui
else
	warn("‚ö†Ô∏è Could not find PlayerGui")
	return
end

-- Main Defense Panel
local defensePanel = Instance.new("Frame", gui)
defensePanel.Size = UDim2.fromOffset(520, 720)
defensePanel.Position = UDim2.new(0.5, -260, 0.5, -360)
defensePanel.BackgroundColor3 = COLORS.BG_GLASS
defensePanel.BackgroundTransparency = 0.08
defensePanel.BorderSizePixel = 0
defensePanel.Active = true
defensePanel.ClipsDescendants = true

local panelCorner = Instance.new("UICorner", defensePanel)
panelCorner.CornerRadius = UDim.new(0, 28)

local panelStroke = Instance.new("UIStroke", defensePanel)
panelStroke.Color = COLORS.DANGER
panelStroke.Thickness = 3
panelStroke.Transparency = 0.2

-- Glass effect layers
local glassLayer1 = Instance.new("Frame", defensePanel)
glassLayer1.Size = UDim2.fromScale(1, 1)
glassLayer1.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
glassLayer1.BackgroundTransparency = 0.95
glassLayer1.BorderSizePixel = 0
glassLayer1.ZIndex = 1
Instance.new("UICorner", glassLayer1).CornerRadius = UDim.new(0, 28)

local glassLayer2 = Instance.new("Frame", defensePanel)
glassLayer2.Size = UDim2.fromScale(1, 0.25)
glassLayer2.BackgroundColor3 = COLORS.DANGER
glassLayer2.BackgroundTransparency = 0.9
glassLayer2.BorderSizePixel = 0
glassLayer2.ZIndex = 1
Instance.new("UICorner", glassLayer2).CornerRadius = UDim.new(0, 28)

local layer2Gradient = Instance.new("UIGradient", glassLayer2)
layer2Gradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, COLORS.DANGER),
	ColorSequenceKeypoint.new(0.5, COLORS.WARNING),
	ColorSequenceKeypoint.new(1, COLORS.DANGER)
})
layer2Gradient.Rotation = 45
layer2Gradient.Transparency = NumberSequence.new({
	NumberSequenceKeypoint.new(0, 0),
	NumberSequenceKeypoint.new(1, 1)
})

-- Animated gradient
task.spawn(function()
	while gui.Parent do
		for i = 45, 405, 0.5 do
			if not gui.Parent then break end
			layer2Gradient.Rotation = i % 360
			task.wait(0.03)
		end
	end
end)

-- Panel glow
local panelGlow = Instance.new("ImageLabel", defensePanel)
panelGlow.Size = UDim2.fromScale(1.03, 1.03)
panelGlow.Position = UDim2.fromScale(0.5, 0.5)
panelGlow.AnchorPoint = Vector2.new(0.5, 0.5)
panelGlow.BackgroundTransparency = 1
panelGlow.Image = "rbxassetid://5028857084"
panelGlow.ImageColor3 = COLORS.DANGER
panelGlow.ImageTransparency = 0.6
panelGlow.ScaleType = Enum.ScaleType.Slice
panelGlow.SliceCenter = Rect.new(24, 24, 276, 276)
panelGlow.ZIndex = 0

-- Draggable functionality
local dragging, dragInput, mousePos, framePos

defensePanel.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		mousePos = input.Position
		framePos = defensePanel.Position
		
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
		local delta = input.Position - mousePos
		TweenService:Create(defensePanel, ANIM.INSTANT, {
			Position = UDim2.new(
				framePos.X.Scale, framePos.X.Offset + delta.X,
				framePos.Y.Scale, framePos.Y.Offset + delta.Y
			)
		}):Play()
	end
end)

-- Header
local header = Instance.new("Frame", defensePanel)
header.Size = UDim2.fromOffset(520, 120)
header.BackgroundColor3 = COLORS.BG_CARD
header.BackgroundTransparency = 0.25
header.BorderSizePixel = 0
header.ZIndex = 3
Instance.new("UICorner", header).CornerRadius = UDim.new(0, 28)

-- Header gradient
local headerGrad = Instance.new("Frame", header)
headerGrad.Size = UDim2.fromScale(1, 0.45)
headerGrad.BackgroundColor3 = COLORS.DANGER
headerGrad.BackgroundTransparency = 0.86
headerGrad.BorderSizePixel = 0
headerGrad.ZIndex = 3
local headerGradCorner = Instance.new("UICorner", headerGrad)
headerGradCorner.CornerRadius = UDim.new(0, 28)
local headerGradGrad = Instance.new("UIGradient", headerGrad)
headerGradGrad.Transparency = NumberSequence.new({
	NumberSequenceKeypoint.new(0, 0),
	NumberSequenceKeypoint.new(1, 1)
})
headerGradGrad.Rotation = 90

-- Shield icon container
local shieldContainer = Instance.new("Frame", header)
shieldContainer.Size = UDim2.fromOffset(80, 80)
shieldContainer.Position = UDim2.fromOffset(15, 20)
shieldContainer.BackgroundColor3 = COLORS.DANGER
shieldContainer.BackgroundTransparency = 0.85
shieldContainer.BorderSizePixel = 0
shieldContainer.ZIndex = 4
Instance.new("UICorner", shieldContainer).CornerRadius = UDim.new(0, 18)

local shieldStroke = Instance.new("UIStroke", shieldContainer)
shieldStroke.Color = COLORS.DANGER
shieldStroke.Thickness = 2
shieldStroke.Transparency = 0.4

local shieldIcon = Instance.new("TextLabel", shieldContainer)
shieldIcon.Size = UDim2.fromScale(1, 1)
shieldIcon.BackgroundTransparency = 1
shieldIcon.Text = "üõ°Ô∏è"
shieldIcon.Font = Enum.Font.GothamBold
shieldIcon.TextSize = 52
shieldIcon.ZIndex = 5

local titleLabel = Instance.new("TextLabel", header)
titleLabel.Size = UDim2.fromOffset(330, 36)
titleLabel.Position = UDim2.fromOffset(110, 22)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "AUTO DEFENSE v3.0"
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 24
titleLabel.TextColor3 = COLORS.TEXT
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.ZIndex = 4

local subtitle = Instance.new("TextLabel", header)
subtitle.Size = UDim2.fromOffset(330, 22)
subtitle.Position = UDim2.fromOffset(110, 62)
subtitle.BackgroundTransparency = 1
subtitle.Text = "ESP Detection & Auto Admin Panel"
subtitle.Font = Enum.Font.Gotham
subtitle.TextSize = 13
subtitle.TextColor3 = COLORS.TEXT_MUTED
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.ZIndex = 4

-- Status badge
local statusBadge = Instance.new("Frame", header)
statusBadge.Size = UDim2.fromOffset(100, 34)
statusBadge.Position = UDim2.fromOffset(110, 88)
statusBadge.BackgroundColor3 = COLORS.DANGER
statusBadge.BackgroundTransparency = 0.12
statusBadge.BorderSizePixel = 0
statusBadge.ZIndex = 4
Instance.new("UICorner", statusBadge).CornerRadius = UDim.new(0, 12)

local statusStroke = Instance.new("UIStroke", statusBadge)
statusStroke.Color = COLORS.DANGER
statusStroke.Thickness = 2
statusStroke.Transparency = 0.3

local statusText = Instance.new("TextLabel", statusBadge)
statusText.Size = UDim2.fromScale(1, 1)
statusText.BackgroundTransparency = 1
statusText.Text = "OFFLINE"
statusText.Font = Enum.Font.GothamBold
statusText.TextSize = 13
statusText.TextColor3 = COLORS.TEXT
statusText.ZIndex = 5

-- Close button
local closeBtn = Instance.new("TextButton", header)
closeBtn.Size = UDim2.fromOffset(45, 45)
closeBtn.Position = UDim2.fromOffset(460, 15)
closeBtn.BackgroundColor3 = COLORS.DANGER
closeBtn.BackgroundTransparency = 0.75
closeBtn.Text = "‚úï"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 22
closeBtn.TextColor3 = COLORS.TEXT
closeBtn.BorderSizePixel = 0
closeBtn.AutoButtonColor = false
closeBtn.ZIndex = 4
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 14)

closeBtn.MouseButton1Click:Connect(function()
	Settings.DefenseEnabled = false
	for _, conn in pairs(detectionConnections) do
		if conn and typeof(conn) == "RBXScriptConnection" then
			conn:Disconnect()
		end
	end
	for _, espData in pairs(playerESP) do
		if espData.box then espData.box:Destroy() end
		if espData.connection then espData.connection:Disconnect() end
	end
	gui:Destroy()
	print("üëã Ducky Auto Defense closed")
end)

-- Tab buttons container
local tabsContainer = Instance.new("Frame", defensePanel)
tabsContainer.Size = UDim2.fromOffset(490, 50)
tabsContainer.Position = UDim2.fromOffset(15, 132)
tabsContainer.BackgroundTransparency = 1
tabsContainer.ZIndex = 3

local tabsLayout = Instance.new("UIListLayout", tabsContainer)
tabsLayout.FillDirection = Enum.FillDirection.Horizontal
tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
tabsLayout.Padding = UDim.new(0, 10)

-- Content container
local contentContainer = Instance.new("Frame", defensePanel)
contentContainer.Size = UDim2.fromOffset(490, 520)
contentContainer.Position = UDim2.fromOffset(15, 192)
contentContainer.BackgroundTransparency = 1
contentContainer.ZIndex = 3

-- Helper: Create tab button
local function createTabButton(name, icon, order)
	local btn = Instance.new("TextButton", tabsContainer)
	btn.Name = name .. "Tab"
	btn.Size = UDim2.fromOffset(150, 50)
	btn.BackgroundColor3 = COLORS.BG_CARD
	btn.BackgroundTransparency = 0.3
	btn.BorderSizePixel = 0
	btn.AutoButtonColor = false
	btn.LayoutOrder = order
	btn.ZIndex = 4
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 14)
	
	local stroke = Instance.new("UIStroke", btn)
	stroke.Color = COLORS.PRIMARY
	stroke.Thickness = 1.5
	stroke.Transparency = 0.65
	
	local iconLabel = Instance.new("TextLabel", btn)
	iconLabel.Size = UDim2.fromOffset(30, 30)
	iconLabel.Position = UDim2.fromOffset(10, 10)
	iconLabel.BackgroundTransparency = 1
	iconLabel.Text = icon
	iconLabel.TextSize = 20
	iconLabel.ZIndex = 5
	
	local label = Instance.new("TextLabel", btn)
	label.Size = UDim2.fromOffset(100, 50)
	label.Position = UDim2.fromOffset(45, 0)
	label.BackgroundTransparency = 1
	label.Text = name
	label.Font = Enum.Font.GothamBold
	label.TextSize = 13
	label.TextColor3 = COLORS.TEXT_MUTED
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.ZIndex = 5
	
	btn.MouseButton1Click:Connect(function()
		currentTab = name
		-- Update all tab buttons
		for _, child in pairs(tabsContainer:GetChildren()) do
			if child:IsA("TextButton") then
				local childStroke = child:FindFirstChildOfClass("UIStroke")
				local childLabel = child:FindFirstChild("TextLabel")
				if child == btn then
					TweenService:Create(child, ANIM.SMOOTH, {BackgroundTransparency = 0.1}):Play()
					TweenService:Create(childStroke, ANIM.SMOOTH, {Color = COLORS.DANGER, Transparency = 0.3}):Play()
					for _, lbl in pairs(child:GetChildren()) do
						if lbl:IsA("TextLabel") then
							lbl.TextColor3 = COLORS.TEXT
						end
					end
				else
					TweenService:Create(child, ANIM.SMOOTH, {BackgroundTransparency = 0.3}):Play()
					TweenService:Create(childStroke, ANIM.SMOOTH, {Color = COLORS.PRIMARY, Transparency = 0.65}):Play()
					for _, lbl in pairs(child:GetChildren()) do
						if lbl:IsA("TextLabel") then
							lbl.TextColor3 = COLORS.TEXT_MUTED
						end
					end
				end
			end
		end
		-- Update content
		for _, child in pairs(contentContainer:GetChildren()) do
			if child:IsA("Frame") then
				child.Visible = (child.Name == name .. "Content")
			end
		end
	end)
	
	return btn
end

-- Create tabs
local defenseTab = createTabButton("Defense", "üõ°Ô∏è", 1)
local optionsTab = createTabButton("Options", "‚öôÔ∏è", 2)
local playersTab = createTabButton("Players", "üë•", 3)

-- Set initial tab
defenseTab.BackgroundTransparency = 0.1
local defenseTabStroke = defenseTab:FindFirstChildOfClass("UIStroke")
defenseTabStroke.Color = COLORS.DANGER
defenseTabStroke.Transparency = 0.3
for _, lbl in pairs(defenseTab:GetChildren()) do
	if lbl:IsA("TextLabel") then
		lbl.TextColor3 = COLORS.TEXT
	end
end

-- Helper: Create toggle switch
local function createToggle(parent, yPos, text, icon, defaultState, callback)
	local container = Instance.new("Frame", parent)
	container.Size = UDim2.fromOffset(490, 60)
	container.Position = UDim2.fromOffset(0, yPos)
	container.BackgroundColor3 = COLORS.BG_CARD
	container.BackgroundTransparency = 0.3
	container.BorderSizePixel = 0
	container.ZIndex = 4
	Instance.new("UICorner", container).CornerRadius = UDim.new(0, 14)
	
	local stroke = Instance.new("UIStroke", container)
	stroke.Color = COLORS.PRIMARY
	stroke.Thickness = 1.5
	stroke.Transparency = 0.65
	
	local iconLabel = Instance.new("TextLabel", container)
	iconLabel.Size = UDim2.fromOffset(40, 40)
	iconLabel.Position = UDim2.fromOffset(15, 10)
	iconLabel.BackgroundTransparency = 1
	iconLabel.Text = icon
	iconLabel.TextSize = 28
	iconLabel.ZIndex = 5
	
	local label = Instance.new("TextLabel", container)
	label.Size = UDim2.fromOffset(340, 60)
	label.Position = UDim2.fromOffset(65, 0)
	label.BackgroundTransparency = 1
	label.Text = text
	label.Font = Enum.Font.GothamBold
	label.TextSize = 14
	label.TextColor3 = COLORS.TEXT
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.ZIndex = 5
	
	local isOn = defaultState
	
	-- Toggle switch
	local toggleBg = Instance.new("Frame", container)
	toggleBg.Size = UDim2.fromOffset(60, 32)
	toggleBg.Position = UDim2.fromOffset(415, 14)
	toggleBg.BackgroundColor3 = isOn and COLORS.SUCCESS or COLORS.TEXT_DARK
	toggleBg.BackgroundTransparency = 0.3
	toggleBg.BorderSizePixel = 0
	toggleBg.ZIndex = 5
	Instance.new("UICorner", toggleBg).CornerRadius = UDim.new(1, 0)
	
	local toggleCircle = Instance.new("Frame", toggleBg)
	toggleCircle.Size = UDim2.fromOffset(26, 26)
	toggleCircle.Position = isOn and UDim2.fromOffset(31, 3) or UDim2.fromOffset(3, 3)
	toggleCircle.BackgroundColor3 = COLORS.TEXT
	toggleCircle.BorderSizePixel = 0
	toggleCircle.ZIndex = 6
	Instance.new("UICorner", toggleCircle).CornerRadius = UDim.new(1, 0)
	
	local toggleBtn = Instance.new("TextButton", container)
	toggleBtn.Size = container.Size
	toggleBtn.BackgroundTransparency = 1
	toggleBtn.Text = ""
	toggleBtn.ZIndex = 7
	
	local function updateToggle()
		TweenService:Create(toggleBg, ANIM.SMOOTH, {
			BackgroundColor3 = isOn and COLORS.SUCCESS or COLORS.TEXT_DARK
		}):Play()
		TweenService:Create(toggleCircle, ANIM.BOUNCE, {
			Position = isOn and UDim2.fromOffset(31, 3) or UDim2.fromOffset(3, 3)
		}):Play()
		if callback then callback(isOn) end
	end
	
	toggleBtn.MouseButton1Click:Connect(function()
		isOn = not isOn
		updateToggle()
	end)
	
	return container, function() return isOn end, function(state) isOn = state updateToggle() end
end

-- Helper: Create slider
local function createSlider(parent, yPos, text, icon, minVal, maxVal, defaultVal, suffix, callback)
	local container = Instance.new("Frame", parent)
	container.Size = UDim2.fromOffset(490, 80)
	container.Position = UDim2.fromOffset(0, yPos)
	container.BackgroundColor3 = COLORS.BG_CARD
	container.BackgroundTransparency = 0.3
	container.BorderSizePixel = 0
	container.ZIndex = 4
	Instance.new("UICorner", container).CornerRadius = UDim.new(0, 14)
	
	local stroke = Instance.new("UIStroke", container)
	stroke.Color = COLORS.PRIMARY
	stroke.Thickness = 1.5
	stroke.Transparency = 0.65
	
	local iconLabel = Instance.new("TextLabel", container)
	iconLabel.Size = UDim2.fromOffset(40, 40)
	iconLabel.Position = UDim2.fromOffset(15, 10)
	iconLabel.BackgroundTransparency = 1
	iconLabel.Text = icon
	iconLabel.TextSize = 28
	iconLabel.ZIndex = 5
	
	local label = Instance.new("TextLabel", container)
	label.Size = UDim2.fromOffset(300, 25)
	label.Position = UDim2.fromOffset(65, 12)
	label.BackgroundTransparency = 1
	label.Text = text
	label.Font = Enum.Font.GothamBold
	label.TextSize = 14
	label.TextColor3 = COLORS.TEXT
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.ZIndex = 5
	
	local valueLabel = Instance.new("TextLabel", container)
	valueLabel.Size = UDim2.fromOffset(100, 25)
	valueLabel.Position = UDim2.fromOffset(375, 12)
	valueLabel.BackgroundTransparency = 1
	valueLabel.Text = defaultVal .. suffix
	valueLabel.Font = Enum.Font.GothamBold
	valueLabel.TextSize = 14
	valueLabel.TextColor3 = COLORS.PRIMARY_LIGHT
	valueLabel.TextXAlignment = Enum.TextXAlignment.Right
	valueLabel.ZIndex = 5
	
	-- Slider track
	local sliderTrack = Instance.new("Frame", container)
	sliderTrack.Size = UDim2.fromOffset(400, 6)
	sliderTrack.Position = UDim2.fromOffset(65, 55)
	sliderTrack.BackgroundColor3 = COLORS.TEXT_DARK
	sliderTrack.BackgroundTransparency = 0.5
	sliderTrack.BorderSizePixel = 0
	sliderTrack.ZIndex = 5
	Instance.new("UICorner", sliderTrack).CornerRadius = UDim.new(1, 0)
	
	-- Slider fill
	local sliderFill = Instance.new("Frame", sliderTrack)
	sliderFill.Size = UDim2.fromScale((defaultVal - minVal) / (maxVal - minVal), 1)
	sliderFill.BackgroundColor3 = COLORS.PRIMARY_LIGHT
	sliderFill.BorderSizePixel = 0
	sliderFill.ZIndex = 6
	Instance.new("UICorner", sliderFill).CornerRadius = UDim.new(1, 0)
	
	-- Slider knob
	local sliderKnob = Instance.new("Frame", sliderTrack)
	sliderKnob.Size = UDim2.fromOffset(18, 18)
	sliderKnob.Position = UDim2.fromScale((defaultVal - minVal) / (maxVal - minVal), 0.5)
	sliderKnob.AnchorPoint = Vector2.new(0.5, 0.5)
	sliderKnob.BackgroundColor3 = COLORS.TEXT
	sliderKnob.BorderSizePixel = 0
	sliderKnob.ZIndex = 7
	Instance.new("UICorner", sliderKnob).CornerRadius = UDim.new(1, 0)
	
	local currentValue = defaultVal
	local dragging = false
	
	local function updateSlider(input)
		local relativeX = math.clamp((input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X, 0, 1)
		currentValue = math.floor(minVal + (maxVal - minVal) * relativeX)
		valueLabel.Text = currentValue .. suffix
		TweenService:Create(sliderFill, ANIM.INSTANT, {Size = UDim2.fromScale(relativeX, 1)}):Play()
		TweenService:Create(sliderKnob, ANIM.INSTANT, {Position = UDim2.fromScale(relativeX, 0.5)}):Play()
		if callback then callback(currentValue) end
	end
	
	sliderTrack.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			updateSlider(input)
		end
	end)
	
	sliderTrack.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			updateSlider(input)
		end
	end)
	
	return container, function() return currentValue end
end

-- DEFENSE TAB CONTENT
local defenseContent = Instance.new("Frame", contentContainer)
defenseContent.Name = "DefenseContent"
defenseContent.Size = UDim2.fromScale(1, 1)
defenseContent.BackgroundTransparency = 1
defenseContent.Visible = true
defenseContent.ZIndex = 3

local defenseScroll = Instance.new("ScrollingFrame", defenseContent)
defenseScroll.Size = UDim2.fromScale(1, 1)
defenseScroll.BackgroundTransparency = 1
defenseScroll.BorderSizePixel = 0
defenseScroll.ScrollBarThickness = 6
defenseScroll.ScrollBarImageColor3 = COLORS.DANGER
defenseScroll.ScrollBarImageTransparency = 0.3
defenseScroll.CanvasSize = UDim2.fromOffset(490, 0)
defenseScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
defenseScroll.ZIndex = 3

local defenseLayout = Instance.new("UIListLayout", defenseScroll)
defenseLayout.SortOrder = Enum.SortOrder.LayoutOrder
defenseLayout.Padding = UDim.new(0, 12)

-- Helper: Send chat message
local function sendChatMessage(message)
	pcall(function()
		local TextChatService = game:GetService("TextChatService")
		local textChannel = TextChatService:WaitForChild("TextChannels", 2):WaitForChild("RBXGeneral", 2)
		if textChannel then
			textChannel:SendAsync(message)
		end
	end)
end

-- Find player base
function findPlayerBase()
	local plotsFolder = workspace:FindFirstChild("Plots")
	if not plotsFolder then return nil end
	
	for _, plot in pairs(plotsFolder:GetChildren()) do
		if plot:IsA("Model") then
			local ownerValue = plot:FindFirstChild("Owner", true)
			if ownerValue then
				local ownerName = ""
				if ownerValue:IsA("StringValue") then
					ownerName = ownerValue.Value
				elseif ownerValue:IsA("ObjectValue") and ownerValue.Value and ownerValue.Value:IsA("Player") then
					ownerName = ownerValue.Value.Name
				end
				
				if ownerName == player.Name then
					return plot
				end
			end
		end
	end
	
	return nil
end

-- Check if player is in base using ESP-like bounds checking
local function isPlayerInBase(targetPlayer)
	if not baseCenter then return false end
	
	local char = targetPlayer.Character
	if not char then return false end
	
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return false end
	
	local distance = (hrp.Position - baseCenter).Magnitude
	return distance <= Settings.DefenseRange
end

-- Execute defense on intruder
local function executeDefenseOnIntruder(intruder)
	if not intruder or not intruder.Parent then return end
	
	-- Cooldown check
	local cooldownKey = intruder.UserId
	if intruderCooldowns[cooldownKey] and tick() - intruderCooldowns[cooldownKey] < Settings.CooldownTime then
		return
	end
	intruderCooldowns[cooldownKey] = tick()
	
	-- Notification
	if Settings.NotifyOnIntruder then
		print(string.format("üö® INTRUDER DETECTED: %s - EXECUTING DEFENSE!", intruder.Name))
	end
	
	-- Auto admin panel
	if Settings.AutoAdminPanel and Settings.UseAdminCommands then
		for _, cmd in pairs(Settings.AdminCommands) do
			pcall(function()
				local chatCommand = ";" .. cmd .. " " .. string.lower(intruder.Name)
				sendChatMessage(chatCommand)
			end)
			task.wait(Settings.CommandDelay)
		end
		print(string.format("‚úÖ Defense executed on %s", intruder.Name))
	end
end

-- Create ESP box for player
local function createESPBox(targetPlayer)
	if playerESP[targetPlayer.UserId] then
		return playerESP[targetPlayer.UserId]
	end
	
	local char = targetPlayer.Character
	if not char then return nil end
	
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return nil end
	
	-- Create ESP box
	local box = Instance.new("BillboardGui")
	box.Name = "ESP_" .. targetPlayer.Name
	box.Adornee = hrp
	box.Size = UDim2.fromOffset(200, 50)
	box.StudsOffset = Vector3.new(0, 3, 0)
	box.AlwaysOnTop = true
	box.Parent = hrp
	
	local frame = Instance.new("Frame", box)
	frame.Size = UDim2.fromScale(1, 1)
	frame.BackgroundTransparency = 1
	
	-- Box outline
	local outline = Instance.new("UIStroke", frame)
	outline.Color = Settings.ESPColor
	outline.Thickness = Settings.ESPThickness
	outline.Transparency = 0.3
	
	-- Name label
	local nameLabel = Instance.new("TextLabel", frame)
	nameLabel.Size = UDim2.fromScale(1, 0.4)
	nameLabel.BackgroundTransparency = 1
	nameLabel.Text = targetPlayer.Name
	nameLabel.Font = Enum.Font.GothamBold
	nameLabel.TextSize = 14
	nameLabel.TextColor3 = COLORS.TEXT
	nameLabel.TextStrokeTransparency = 0.5
	nameLabel.Visible = Settings.ShowName
	
	-- Distance label
	local distLabel = Instance.new("TextLabel", frame)
	distLabel.Size = UDim2.fromScale(1, 0.3)
	distLabel.Position = UDim2.fromScale(0, 0.4)
	distLabel.BackgroundTransparency = 1
	distLabel.Text = "0 studs"
	distLabel.Font = Enum.Font.Gotham
	distLabel.TextSize = 12
	distLabel.TextColor3 = COLORS.SUCCESS
	distLabel.TextStrokeTransparency = 0.5
	distLabel.Visible = Settings.ShowDistance
	
	-- Status label
	local statusLabel = Instance.new("TextLabel", frame)
	statusLabel.Size = UDim2.fromScale(1, 0.3)
	statusLabel.Position = UDim2.fromScale(0, 0.7)
	statusLabel.BackgroundTransparency = 1
	statusLabel.Text = "SAFE"
	statusLabel.Font = Enum.Font.GothamBold
	statusLabel.TextSize = 13
	statusLabel.TextColor3 = COLORS.SUCCESS
	statusLabel.TextStrokeTransparency = 0.5
	
	-- Update ESP in real-time
	local connection = RunService.Heartbeat:Connect(function()
		if not targetPlayer or not targetPlayer.Parent or not player.Character then
			if connection then connection:Disconnect() end
			if box then box:Destroy() end
			playerESP[targetPlayer.UserId] = nil
			return
		end
		
		local myHRP = player.Character:FindFirstChild("HumanoidRootPart")
		local theirChar = targetPlayer.Character
		local theirHRP = theirChar and theirChar:FindFirstChild("HumanoidRootPart")
		
		if myHRP and theirHRP then
			local distance = (myHRP.Position - theirHRP.Position).Magnitude
			distLabel.Text = string.format("%.0f studs", distance)
			
			-- Check if in base
			if isPlayerInBase(targetPlayer) then
				-- IN BASE - THREAT
				statusLabel.Text = "IN BASE ‚ö†Ô∏è"
				statusLabel.TextColor3 = COLORS.DANGER
				outline.Color = COLORS.DANGER
				distLabel.TextColor3 = COLORS.DANGER
				
				-- Auto defense
				if Settings.DefenseEnabled then
					task.wait(Settings.DetectionDelay)
					if isPlayerInBase(targetPlayer) then -- Double check
						executeDefenseOnIntruder(targetPlayer)
					end
				end
			else
				-- SAFE
				statusLabel.Text = "SAFE ‚úì"
				statusLabel.TextColor3 = COLORS.SUCCESS
				outline.Color = Settings.ESPColor
				
				if distance < 50 then
					distLabel.TextColor3 = COLORS.WARNING
				else
					distLabel.TextColor3 = COLORS.SUCCESS
				end
			end
		end
		
		-- Update visibility based on settings
		nameLabel.Visible = Settings.ShowName
		distLabel.Visible = Settings.ShowDistance
		box.Enabled = Settings.ShowESP
	end)
	
	playerESP[targetPlayer.UserId] = {
		box = box,
		connection = connection
	}
	
	return playerESP[targetPlayer.UserId]
end

-- Create player card
local function createPlayerCard(targetPlayer)
	if playerCards[targetPlayer.UserId] then
		return playerCards[targetPlayer.UserId]
	end
	
	local card = Instance.new("Frame", playersList)
	card.Name = "PlayerCard_" .. targetPlayer.Name
	card.Size = UDim2.fromOffset(454, 90)
	card.BackgroundColor3 = COLORS.BG_GLASS
	card.BackgroundTransparency = 0.35
	card.BorderSizePixel = 0
	card.ZIndex = 4
	Instance.new("UICorner", card).CornerRadius = UDim.new(0, 14)
	
	local cardStroke = Instance.new("UIStroke", card)
	cardStroke.Color = COLORS.PRIMARY
	cardStroke.Thickness = 1.5
	cardStroke.Transparency = 0.65
	
	-- Avatar
	local avatar = Instance.new("ImageLabel", card)
	avatar.Size = UDim2.fromOffset(70, 70)
	avatar.Position = UDim2.fromOffset(10, 10)
	avatar.BackgroundColor3 = COLORS.BG_DARK
	avatar.BorderSizePixel = 0
	avatar.Image = "rbxthumb://type=AvatarHeadShot&id=" .. targetPlayer.UserId .. "&w=150&h=150"
	avatar.ZIndex = 5
	Instance.new("UICorner", avatar).CornerRadius = UDim.new(0, 12)
	
	local avatarStroke = Instance.new("UIStroke", avatar)
	avatarStroke.Color = COLORS.PRIMARY_LIGHT
	avatarStroke.Thickness = 2
	avatarStroke.Transparency = 0.5
	
	-- Username
	local username = Instance.new("TextLabel", card)
	username.Size = UDim2.fromOffset(240, 22)
	username.Position = UDim2.fromOffset(90, 12)
	username.BackgroundTransparency = 1
	username.Text = targetPlayer.Name
	username.Font = Enum.Font.GothamBold
	username.TextSize = 14
	username.TextColor3 = COLORS.TEXT
	username.TextXAlignment = Enum.TextXAlignment.Left
	username.TextTruncate = Enum.TextTruncate.AtEnd
	username.ZIndex = 5
	
	-- Display name
	local displayName = Instance.new("TextLabel", card)
	displayName.Size = UDim2.fromOffset(240, 18)
	displayName.Position = UDim2.fromOffset(90, 36)
	displayName.BackgroundTransparency = 1
	displayName.Text = "@" .. targetPlayer.DisplayName
	displayName.Font = Enum.Font.Gotham
	displayName.TextSize = 11
	displayName.TextColor3 = COLORS.TEXT_MUTED
	displayName.TextXAlignment = Enum.TextXAlignment.Left
	displayName.TextTruncate = Enum.TextTruncate.AtEnd
	displayName.ZIndex = 5
	
	-- Distance label
	local distanceLabel = Instance.new("TextLabel", card)
	distanceLabel.Size = UDim2.fromOffset(240, 20)
	distanceLabel.Position = UDim2.fromOffset(90, 58)
	distanceLabel.BackgroundTransparency = 1
	distanceLabel.Text = "üìè Calculating..."
	distanceLabel.Font = Enum.Font.GothamBold
	distanceLabel.TextSize = 13
	distanceLabel.TextColor3 = COLORS.SUCCESS
	distanceLabel.TextXAlignment = Enum.TextXAlignment.Left
	distanceLabel.ZIndex = 5
	
	-- Status indicator
	local statusIndicator = Instance.new("Frame", card)
	statusIndicator.Size = UDim2.fromOffset(85, 28)
	statusIndicator.Position = UDim2.fromOffset(359, 12)
	statusIndicator.BackgroundColor3 = COLORS.SUCCESS
	statusIndicator.BackgroundTransparency = 0.15
	statusIndicator.BorderSizePixel = 0
	statusIndicator.ZIndex = 5
	Instance.new("UICorner", statusIndicator).CornerRadius = UDim.new(0, 10)
	
	local statusStroke = Instance.new("UIStroke", statusIndicator)
	statusStroke.Color = COLORS.SUCCESS
	statusStroke.Thickness = 1.5
	statusStroke.Transparency = 0.4
	
	local statusText = Instance.new("TextLabel", statusIndicator)
	statusText.Size = UDim2.fromScale(1, 1)
	statusText.BackgroundTransparency = 1
	statusText.Text = "SAFE"
	statusText.Font = Enum.Font.GothamBold
	statusText.TextSize = 11
	statusText.TextColor3 = COLORS.TEXT
	statusText.ZIndex = 6
	
	-- Attack button
	local attackBtn = Instance.new("TextButton", card)
	attackBtn.Size = UDim2.fromOffset(85, 28)
	attackBtn.Position = UDim2.fromOffset(359, 52)
	attackBtn.BackgroundColor3 = COLORS.DANGER
	attackBtn.BackgroundTransparency = 0.15
	attackBtn.Text = "DEFEND"
	attackBtn.Font = Enum.Font.GothamBold
	attackBtn.TextSize = 11
	attackBtn.TextColor3 = COLORS.TEXT
	attackBtn.BorderSizePixel = 0
	attackBtn.AutoButtonColor = false
	attackBtn.ZIndex = 5
	Instance.new("UICorner", attackBtn).CornerRadius = UDim.new(0, 10)
	
	local attackStroke = Instance.new("UIStroke", attackBtn)
	attackStroke.Color = COLORS.DANGER
	attackStroke.Thickness = 1.5
	attackStroke.Transparency = 0.4
	
	attackBtn.MouseButton1Click:Connect(function()
		if Settings.UseAdminCommands then
			attackBtn.Text = "ATTACKING..."
			executeDefenseOnIntruder(targetPlayer)
			task.wait(1)
			if attackBtn and attackBtn.Parent then
				attackBtn.Text = "DEFEND"
			end
		else
			print("‚ö†Ô∏è Admin commands are disabled!")
		end
	end)
	
	-- Update distance in real-time
	local updateConnection = RunService.Heartbeat:Connect(function()
		if not targetPlayer or not targetPlayer.Parent or not player.Character then
			if updateConnection then updateConnection:Disconnect() end
			if card and card.Parent then card:Destroy() end
			playerCards[targetPlayer.UserId] = nil
			return
		end
		
		local myHRP = player.Character:FindFirstChild("HumanoidRootPart")
		local theirChar = targetPlayer.Character
		local theirHRP = theirChar and theirChar:FindFirstChild("HumanoidRootPart")
		
		if myHRP and theirHRP then
			local distance = (myHRP.Position - theirHRP.Position).Magnitude
			distanceLabel.Text = string.format("üìè %.0f studs", distance)
			
			-- Check if in base
			if isPlayerInBase(targetPlayer) then
				-- IN BASE - THREAT
				statusText.Text = "IN BASE"
				TweenService:Create(statusIndicator, ANIM.FAST, {BackgroundColor3 = COLORS.DANGER}):Play()
				TweenService:Create(statusStroke, ANIM.FAST, {Color = COLORS.DANGER}):Play()
				TweenService:Create(cardStroke, ANIM.FAST, {Color = COLORS.DANGER, Transparency = 0.4}):Play()
				TweenService:Create(avatarStroke, ANIM.FAST, {Color = COLORS.DANGER}):Play()
			else
				-- SAFE
				statusText.Text = "SAFE"
				TweenService:Create(statusIndicator, ANIM.FAST, {BackgroundColor3 = COLORS.SUCCESS}):Play()
				TweenService:Create(statusStroke, ANIM.FAST, {Color = COLORS.SUCCESS}):Play()
				TweenService:Create(cardStroke, ANIM.FAST, {Color = COLORS.PRIMARY, Transparency = 0.65}):Play()
				TweenService:Create(avatarStroke, ANIM.FAST, {Color = COLORS.PRIMARY_LIGHT}):Play()
			end
			
			-- Update distance color
			if distance < 50 then
				distanceLabel.TextColor3 = COLORS.DANGER
			elseif distance < 150 then
				distanceLabel.TextColor3 = COLORS.WARNING
			else
				distanceLabel.TextColor3 = COLORS.SUCCESS
			end
		end
	end)
	
	playerCards[targetPlayer.UserId] = {
		card = card,
		connection = updateConnection
	}
	
	-- Also create ESP for this player
	createESPBox(targetPlayer)
	
	return playerCards[targetPlayer.UserId]
end

-- Refresh player list
local function refreshPlayerList()
	for _, targetPlayer in pairs(Players:GetPlayers()) do
		if targetPlayer ~= player then
			createPlayerCard(targetPlayer)
			createESPBox(targetPlayer)
		end
	end
end

-- Defense toggles
local defenseToggle, getDefenseState, setDefenseState = createToggle(
	defenseScroll, 0, "Enable Auto Defense", "üõ°Ô∏è", false,
	function(state)
		Settings.DefenseEnabled = state
		if state then
			statusText.Text = "ONLINE"
			TweenService:Create(statusBadge, ANIM.SMOOTH, {BackgroundColor3 = COLORS.SUCCESS}):Play()
			TweenService:Create(statusStroke, ANIM.SMOOTH, {Color = COLORS.SUCCESS_GLOW}):Play()
			print("üõ°Ô∏è Auto Defense: ONLINE")
			-- Find base
			local myBase = findPlayerBase()
			if myBase then
				baseCenter = myBase:GetPivot().Position
				baseBounds = myBase:GetExtentsSize()
				print("üõ°Ô∏è Base located at:", baseCenter)
			else
				warn("‚ö†Ô∏è Could not find your base!")
			end
		else
			statusText.Text = "OFFLINE"
			TweenService:Create(statusBadge, ANIM.SMOOTH, {BackgroundColor3 = COLORS.DANGER}):Play()
			TweenService:Create(statusStroke, ANIM.SMOOTH, {Color = COLORS.DANGER}):Play()
			print("‚õî Auto Defense: OFFLINE")
		end
	end
)

local autoAdminToggle = createToggle(
	defenseScroll, 72, "Auto Admin Panel", "‚ö°", false,
	function(state)
		Settings.AutoAdminPanel = state
		print("‚ö° Auto Admin Panel:", state and "ENABLED" or "DISABLED")
	end
)

local notifyToggle = createToggle(
	defenseScroll, 144, "Notify on Intruder", "üîî", false,
	function(state)
		Settings.NotifyOnIntruder = state
		print("üîî Notifications:", state and "ENABLED" or "DISABLED")
	end
)

local espToggle = createToggle(
	defenseScroll, 216, "Show ESP Boxes", "üì¶", true,
	function(state)
		Settings.ShowESP = state
		-- Update all ESP
		for _, espData in pairs(playerESP) do
			if espData.box then
				espData.box.Enabled = state
			end
		end
		print("üì¶ ESP:", state and "ENABLED" or "DISABLED")
	end
)

-- OPTIONS TAB CONTENT
local optionsContent = Instance.new("Frame", contentContainer)
optionsContent.Name = "OptionsContent"
optionsContent.Size = UDim2.fromScale(1, 1)
optionsContent.BackgroundTransparency = 1
optionsContent.Visible = false
optionsContent.ZIndex = 3

local optionsScroll = Instance.new("ScrollingFrame", optionsContent)
optionsScroll.Size = UDim2.fromScale(1, 1)
optionsScroll.BackgroundTransparency = 1
optionsScroll.BorderSizePixel = 0
optionsScroll.ScrollBarThickness = 6
optionsScroll.ScrollBarImageColor3 = COLORS.PRIMARY
optionsScroll.ScrollBarImageTransparency = 0.3
optionsScroll.CanvasSize = UDim2.fromOffset(490, 0)
optionsScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
optionsScroll.ZIndex = 3

local optionsLayout = Instance.new("UIListLayout", optionsScroll)
optionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
optionsLayout.Padding = UDim.new(0, 12)

-- Options sliders
createSlider(
	optionsScroll, 0, "Detection Range", "üìè", 20, 200, 50, " studs",
	function(value)
		Settings.DefenseRange = value
	end
)

createSlider(
	optionsScroll, 92, "Detection Delay", "‚è±Ô∏è", 0, 5, 0.5, "s",
	function(value)
		Settings.DetectionDelay = value
	end
)

createSlider(
	optionsScroll, 184, "Cooldown Time", "‚è≥", 5, 60, 15, "s",
	function(value)
		Settings.CooldownTime = value
	end
)

createSlider(
	optionsScroll, 276, "Command Delay", "‚öôÔ∏è", 0.1, 2, 0.2, "s",
	function(value)
		Settings.CommandDelay = value
	end
)

-- Admin commands toggle
local adminCmdsToggle = createToggle(
	optionsScroll, 368, "Use Admin Commands", "üîß", false,
	function(state)
		Settings.UseAdminCommands = state
		print("üîß Admin Commands:", state and "ENABLED" or "DISABLED")
	end
)

-- ESP options
local showDistToggle = createToggle(
	optionsScroll, 440, "Show Distance on ESP", "üìç", true,
	function(state)
		Settings.ShowDistance = state
	end
)

local showNameToggle = createToggle(
	optionsScroll, 512, "Show Names on ESP", "üè∑Ô∏è", true,
	function(state)
		Settings.ShowName = state
	end
)

-- PLAYERS TAB CONTENT
local playersContent = Instance.new("Frame", contentContainer)
playersContent.Name = "PlayersContent"
playersContent.Size = UDim2.fromScale(1, 1)
playersContent.BackgroundTransparency = 1
playersContent.Visible = false
playersContent.ZIndex = 3

local playersList = Instance.new("ScrollingFrame", playersContent)
playersList.Size = UDim2.fromScale(1, 1)
playersList.BackgroundColor3 = COLORS.BG_CARD
playersList.BackgroundTransparency = 0.35
playersList.BorderSizePixel = 0
playersList.ScrollBarThickness = 6
playersList.ScrollBarImageColor3 = COLORS.DANGER
playersList.ScrollBarImageTransparency = 0.3
playersList.CanvasSize = UDim2.fromOffset(490, 0)
playersList.AutomaticCanvasSize = Enum.AutomaticSize.Y
playersList.ZIndex = 3
Instance.new("UICorner", playersList).CornerRadius = UDim.new(0, 18)

local playersLayout = Instance.new("UIListLayout", playersList)
playersLayout.SortOrder = Enum.SortOrder.LayoutOrder
playersLayout.Padding = UDim.new(0, 10)

local playersPadding = Instance.new("UIPadding", playersList)
playersPadding.PaddingTop = UDim.new(0, 12)
playersPadding.PaddingBottom = UDim.new(0, 12)
playersPadding.PaddingLeft = UDim.new(0, 12)
playersPadding.PaddingRight = UDim.new(0, 12)

-- Player tracking
Players.PlayerAdded:Connect(function(newPlayer)
	task.wait(0.5)
	if newPlayer ~= player and newPlayer.Character then
		createPlayerCard(newPlayer)
		createESPBox(newPlayer)
	end
end)

Players.PlayerRemoving:Connect(function(removedPlayer)
	if playerCards[removedPlayer.UserId] then
		local data = playerCards[removedPlayer.UserId]
		if data.connection then
			data.connection:Disconnect()
		end
		if data.card and data.card.Parent then
			data.card:Destroy()
		end
		playerCards[removedPlayer.UserId] = nil
	end
	
	if playerESP[removedPlayer.UserId] then
		local espData = playerESP[removedPlayer.UserId]
		if espData.connection then
			espData.connection:Disconnect()
		end
		if espData.box then
			espData.box:Destroy()
		end
		playerESP[removedPlayer.UserId] = nil
	end
end)

-- Character added handler for ESP
Players.PlayerAdded:Connect(function(newPlayer)
	newPlayer.CharacterAdded:Connect(function()
		task.wait(0.5)
		if newPlayer ~= player then
			createESPBox(newPlayer)
		end
	end)
end)

-- Initialize players
refreshPlayerList()

-- Entrance animation
defensePanel.Size = UDim2.fromOffset(0, 0)
defensePanel.Position = UDim2.new(0.5, 0, 0.5, 0)
defensePanel.BackgroundTransparency = 1

TweenService:Create(defensePanel, TweenInfo.new(0.8, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
	Size = UDim2.fromOffset(520, 720),
	Position = UDim2.new(0.5, -260, 0.5, -360),
	BackgroundTransparency = 0.08
}):Play()

task.wait(0.4)

for _, child in pairs(defensePanel:GetDescendants()) do
	if child:IsA("TextLabel") or child:IsA("TextButton") then
		local origTrans = child.TextTransparency
		child.TextTransparency = 1
		TweenService:Create(child, TweenInfo.new(0.6), {TextTransparency = origTrans}):Play()
	end
end

print("‚úÖ Ducky Auto Defense v3.0 loaded!")
print("üõ°Ô∏è Features: ESP Detection, Auto Admin Panel, Options Tab")
print("üë• Tracking", #Players:GetPlayers() - 1, "players")
print("‚ö° Enable defense to protect your base")
